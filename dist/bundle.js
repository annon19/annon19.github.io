!function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist",t(t.s=5)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13);t.diel=new r.default,window.diel=t.diel},function(e,t){e.exports=React},function(e,t){e.exports=d3},function(e,t,n){"use strict";function r(e,t){if(!e||!e.values)throw new Error("Query "+t+" has NO result")}function a(e,t){var n=e.exec(t);n.length>0?(n[0].values.map(function(e){e.map(function(e,t){"ts"===n[0].columns[t]&&(e=new Date(e).toDateString())})}),console.log(n[0].columns.join("\t")),console.log(JSON.stringify(n[0].values).replace(/\],\[/g,"\n").replace("[[","").replace("]]","").replace(/,/g,"\t"))):console.log("NO RESULT")}function o(e,t){return console.log("["+t+"] "+e),1}function i(){return+new Date}function s(e,t){for(var n=e.split("-"),r=t.split("-"),a=0;a<n.length;a++){var o=function(e){var t=n[e],a=t.split(":")[0],o=r.filter(function(e){return e.split(":")[0]===a});return 1!==o.length?(console.log("didn't find",a,r),{value:0}):o[0]!==t?{value:0}:void 0}(a);if("object"==typeof o)return o.value}return 1}function l(){return(new Date).toTimeString().substr(0,8)}function c(e,t,n){void 0===n&&(n="db");var r=document.createElement("a");r.href=window.URL.createObjectURL(e),r.download=t+"_"+l()+"."+n,r.onclick=function(){setTimeout(function(){window.URL.revokeObjectURL(r.href)},1500)},r.click()}function u(e,t){var n="",r=e.exec(t);if(r.length&&r[0].values){n+=r[0].columns.join(",")+"\r\n",r[0].values.forEach(function(e){var t=e.join(",");n+=t+"\r\n"});c(new Blob([n],{type:"text/plain;charset=UTF-8"}),"userData.csv"),console.log("should have downloaded",n)}else console.log("NO RESULT")}Object.defineProperty(t,"__esModule",{value:!0}),t.assertQueryHasResult=r,t.d=a,window.d=a,t.log=o,t.timeNow=i,t.hashCompare=s,t.prettyTimeNow=l,t.downloadHelper=c,t.downloadQueryResultAsCSV=u},function(e,t,n){"use strict";function r(e,t,n){return!!e&&(t<e.high&&t>e.low&&n<e.high2&&n>e.low2)}function a(e){return e&&e.low&&e.high&&e.low2&&e.high2?e.low.toString()+e.high.toString()+e.low2.toString()+e.high2.toString():""}function o(e){return"x1"in e&&"x2"in e}function i(e){return!!e&&("string"==typeof e?e.length>0:o(e)?!!(e.low&&e.high&&e.low2&&e.high2):!(!e.low||!e.high))}Object.defineProperty(t,"__esModule",{value:!0}),t.lightBlue="rgba(76, 120, 168, 0.5)",t.selectedColor="orange",t.scatterDark="darkblue",t.scatterLight="LemonChiffon",t.scatterBaseDark="lightgray",t.scatterBaseLight="darkgray",t.lightGray="rgba(0, 0, 0, 0.07)",t.selectedBackgroundColor="rgba(255, 165, 0, 0.4)",t.brushColor="rgba(128,128,128, 0.3)",t.LayoutInfo={timeLine:{width:750,height:80,marginBottom:40,marginLeft:40,marginRight:50,marginTop:25},delays:{width:100,height:300,marginTop:1,marginBottom:60,marginLeft:40,marginRight:10,verticalOrientation:!0},chronDelays:{width:35,height:70,marginTop:1,marginBottom:1,marginLeft:1,marginRight:1,verticalOrientation:!0},carrier:{width:300,height:150,marginLeft:1,marginTop:10,marginBottom:60,marginRight:50,verticalOrientation:!1},chronCarrier:{width:70,height:35,marginTop:1,marginBottom:1,marginLeft:1,marginRight:1,verticalOrientation:!1},state:{width:300,height:150,marginLeft:1,marginTop:10,marginBottom:40,marginRight:50,verticalOrientation:!1},chronState:{width:70,height:35,marginTop:1,marginBottom:1,marginLeft:1,marginRight:1,verticalOrientation:!1},day:{width:300,height:150,marginLeft:1,marginTop:10,marginBottom:40,marginRight:50,verticalOrientation:!1},chronDay:{width:70,height:35,marginTop:1,marginBottom:1,marginLeft:1,marginRight:1,verticalOrientation:!1}},t.DefaultChartProps={baseFill:t.lightBlue,showIntro:!1,selectFill:t.selectedColor,annotations:!0,verticalOrientation:!0,debug:!1,isChron:!1,chronRank:-1},t.rectContains=r,t.rectToString=a,t.hasBrushSelection=i},function(e,t,n){"use strict";function r(){o.render(a.createElement(i.PageContainer,null),document.getElementById("wrapper"))}Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),o=n(9),i=n(10);t.loadPage=r},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),o=n(2),i=n(12),s=n(0),l=n(4),c=n(16),u=n(17),h=function(e){function t(t){var n=e.call(this,t)||this;n.refreshSelection=n.refreshSelection.bind(n),n.refreshData=n.refreshData.bind(n),n.refreshIsLoading=n.refreshIsLoading.bind(n);var r=t.isChron?t.chart.slice(5).toLowerCase():t.chart;return n.state={baseData:s.diel.GetStaticView(r+"ChartInitData"),isLoading:t.isChron?{status:0}:{status:1}},n}return r(t,e),t.prototype.refreshSelection=function(e){this.setState({selection:e})},t.prototype.refreshData=function(e){this.setState({data:e})},t.prototype.refreshIsLoading=function(e){this.setState({isLoading:e})},t.prototype.componentDidMount=function(){var e=this.props,t=e.chart,n=e.isChron,r=e.chronRank;if(n){var a={$chronRank:r};s.diel.BindOutput(t+"ChartDataView",this.refreshData,{singleRow:!1,parameters:a}),s.diel.BindOutput(t+"ChartSelection",this.refreshSelection,{singleRow:!0,parameters:a})}else s.diel.BindOutput(t+"ChartIsLoading",this.refreshIsLoading,{singleRow:!0}),s.diel.BindOutput(t+"ChartDataView",this.refreshData),s.diel.BindOutput(t+"ChartSelection",this.refreshSelection,{singleRow:!0})},t.prototype.render=function(){var e=this.props,t=e.chart,n=e.xLabel,r=e.isCategorical,s=e.clipped,h=e.isChron;if(!this.state||!this.state.baseData||0===this.state.baseData.length)throw new Error("Data for chart "+t+" should be here already");var d=l.LayoutInfo[t],f=d.marginTop,p=d.marginRight,m=d.marginLeft,g=d.marginBottom,y=l.LayoutInfo[t],v=y.width,w=y.height,b=y.verticalOrientation,x=this.state,C=x.baseData,I=x.selection,k=x.data,E=x.isLoading;if(h&&(!k||0===k.length))return a.createElement("div",{className:"chart-container bar-chart",style:{width:b?v:w,height:b?w:v}});var S,L,_=v-m-p,D=w-f-g;L=r?u.CategoricalChartHelper({baseData:C,data:k,selection:I,chart:t,chartWidth:_,chartHeight:D,clipped:s}):c.linearChartHelper({baseData:C,data:k,selection:I,chart:t,chartWidth:_,chartHeight:D,clipped:s});var O;if(!h){var R=o.brushX().extent([[0,0],[_,D]]).on("start",function(){}).on("end",function(){if(o.event.sourceEvent&&o.event.selection){var e=o.brushSelection(this);null!==e&&L.brushFn(Math.min(e[0],e[1]),Math.max(e[0],e[1])),o.select(this).call(R.move,null)}});O=a.createElement("g",{ref:function(e){return o.select(e).call(R)}})}var T,N=this.props.clipped?5:this.state.data?Math.min(Math.max.apply(Math,this.state.data.map(function(e){return e.y})),5):5,B=C.length,M=o.axisBottom(L.x).ticks(B),$=o.axisLeft(L.y).ticks(N,"d").tickSizeOuter(0),P=b?"":"rotate90x",j=b?"textRotate30":"rotate90y",q=a.createElement(a.Fragment,null,a.createElement("g",{ref:function(e){o.select(e).call($)},transform:b?"":"translate("+_+", 0)",className:P}),a.createElement("g",{ref:function(e){o.select(e).call(M)},transform:"translate(0,"+D+")",className:j})),A=a.createElement("g",null,a.createElement("text",{className:"chart-label",x:b?_/2+m:10,y:b?w-5:v/2,transform:b?"":"rotate(-90, 10, "+v/2+")",textAnchor:"middle"}," ",n)),F=L.rectsSpec.map(function(e){if(isNaN(e.x))throw console.log(e,t,L.rectsSpec),new Error("found the nan");return a.createElement("rect",{className:e.className?e.className:"select-bars",x:e.x,y:e.y,width:e.barWidth,height:D-e.y,fill:e.color,onClick:h?null:e.onClick})}),W=v,H=w,V=a.createElement("g",{transform:"translate("+m+", "+f+")"},q,O,F);b?T=V:(W=w,H=v,T=a.createElement("g",{transform:"translate("+W+", 0) rotate(90)"},V)),S=a.createElement("svg",{width:W,height:H,className:"chart-svg"},T,h?null:A);var U,Q=h||1!==E.status?"":"indicatorLine";if(r)U=this.state.selection?this.state.selection.selection:null,U=U?U.length>10?U.slice(0,10)+"...":U:null;else if(this.state.selection){var G=this.state.selection.low,z=this.state.selection.high;G&&(U=G===z?""+G:G+" to "+z)}return a.createElement("div",{className:"chart-container bar-chart"},h?null:a.createElement("div",{style:{height:20,overflow:"hidden"}},a.createElement("p",{className:"chart-filter"},U?"selected "+U:" ")),S,a.createElement("div",{style:{height:5},className:Q}),a.createElement("div",null,h?null:a.createElement(i.ResetButton,{width:W,disabled:!L.hasSelection,chart:t,selection:U})))},t.defaultProps=l.DefaultChartProps,t}(a.Component);t.default=h},function(e,t,n){"use strict";function r(e){e.onmessage=function(e){i.diel.exec("insert into workerCmds values ('"+e.data.id+"')");var t=e.data.id.split(":");switch(t[0]){case"download":var n=new Blob([e.data.buffer]);s.downloadHelper(n,"workerSession");break;case"share":var r=t[1],a=t[2],c=t[3],u="";if(e.data.results[0]&&e.data.results[0].values.length>0){var h=e.data.results[0].values,d=void 0;d="day"===a?function(e){return"("+r+", "+e[0]+", "+e[1]+")"}:function(e){return"("+r+", '"+e[0]+"', "+e[1]+")"},u="INSERT INTO "+a+"ChartData VALUES "+h.map(d)+";"}else console.log("No result for",a,r);window.setTimeout(function(){if(i.diel.deadRequests.indexOf(c)>-1)return void console.log("expired",r,a);u+="\nINSERT INTO chartDataAtomic VALUES ("+s.timeNow()+", "+r+", '"+a+"');",i.diel.exec(u)},o.getLatency(l));break;case"print":var f=e.data.results;f&&f.length>0&&(f[0].values.map(function(e){e.map(function(e,t){"ts"===f[0].columns[t]&&(e=new Date(e).toDateString())})}),console.log("Printing results"),console.log(f[0].columns.join("\t")),console.log(JSON.stringify(f[0].values).replace(/\],\[/g,"\n").replace("[[","").replace("]]","").replace(/,/g,"\t")))}}}Object.defineProperty(t,"__esModule",{value:!0});var a,o=n(8),i=n(0),s=n(3);!function(e){e[e.None=0]="None",e[e.Low=1]="Low",e[e.High=2]="High"}(a=t.LatencyOption||(t.LatencyOption={}));var l=a.High;t.setUpWorker=r},function(e,t,n){"use strict";function r(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),200===t.status?t.responseText:""}function a(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.onload=function(){return t(r.responseText)},r.onerror=function(){return n(r.statusText)},r.send()})}function o(e){return e===s.LatencyOption.None?0:e===s.LatencyOption.Low?500+500*Math.random():3e3+2e3*Math.random()}function i(e){if(!e)return!0;for(var n=0;n<t.AllCharts.length;n++)if(e.indexOf(t.AllCharts[n])<0)return!0;return!1}Object.defineProperty(t,"__esModule",{value:!0});var s=n(7);t.ScatterChartsBrushs=["arrDelay","depDelay"],t.AllCharts=["carrier","day","state","delays"];!function(e){e[e.Browser=0]="Browser",e[e.ExpVersion=1]="ExpVersion",e[e.IsMobile=2]="IsMobile",e[e.ScreenWidth=3]="ScreenWidth",e[e.ScreenHeight=4]="ScreenHeight",e[e.WindowWidth=5]="WindowWidth",e[e.WindowHeight=6]="WindowHeight",e[e.IsChronicles=7]="IsChronicles",e[e.HappyOrNot=8]="HappyOrNot",e[e.Clip=9]="Clip",e[e.Focus=10]="Focus",e[e.Blur=11]="Blur"}(t.EventType||(t.EventType={}));!function(e){e[e.Fixed=0]="Fixed",e[e.Variable=1]="Variable"}(t.ScaleOption||(t.ScaleOption={}));!function(e){e[e.SmallMultiples=0]="SmallMultiples",e[e.Scrubber=1]="Scrubber",e[e.FilmStrip=2]="FilmStrip"}(t.HistoryDisplayOption||(t.HistoryDisplayOption={})),t.readFileSync=r,t.readFileAsync=a,t.getLatency=o,t.isLoading=i},function(e,t){e.exports=ReactDOM},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),a=n(11),o=n(21);t.PageContainer=function(){return r.createElement(r.Fragment,null,r.createElement("h2",null,"Crossfilter Implemented in DIEL"),r.createElement("p",null,"The top visualization is a straight forward adaptation of the crossfilter of the flights dataset. The bottom is a design shows a history of past interaction result that are all asycnhronously rendered."),r.createElement("p",null,"All the interactions, including navigating the small thumbnails are implemented in DIEL. The DIEL part of the source code can be found ",r.createElement("a",{href:"https://github.com/annon19/annon19.github.io"},"here"),". It also makes use of another database running in a WebWorker. The latency is instrumented to demonstrate how the interface deal with the asynchorny. The rest are standard UI set up (React with D3)."),r.createElement("p",null,"We provide a basic walk through of some DIEL queries used to specify this interactive visualization."),r.createElement(a.default,{showIntro:!1}),r.createElement(o.default,null))}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),o=n(6),i=n(0),s=n(8),l=n(18),c=n(20),u=function(e){function t(t){var n=e.call(this,t)||this;return n.handleKeyDown=n.handleKeyDown.bind(n),n.toggleClip=n.toggleClip.bind(n),n.setControl=n.setControl.bind(n),n.state={control:!0,clipped:!0},i.diel.BindFreeze(n.setControl),n}return r(t,e),t.prototype.setControl=function(e){this.setState({control:e})},t.prototype.componentWillMount=function(){c.IsChronicles&&document.addEventListener("keydown",this.handleKeyDown)},t.prototype.componentWillUnmount=function(){c.IsChronicles&&document.removeEventListener("keydown",this.handleKeyDown)},t.prototype.componentDidMount=function(){console.log("React all setup, calling tick"),i.diel.tick()()},t.prototype.handleKeyDown=function(e){38===e.keyCode||37===e.keyCode?i.diel.Input.deltaItx({$val:-1}):40!==e.keyCode&&39!==e.keyCode||i.diel.Input.deltaItx({$val:1})},t.prototype.toggleClip=function(){this.setState(function(e){var t=!e.clipped;return i.diel.LogData.eventLog({$eventName:s.EventType[s.EventType.Clip],$parameter:t}),{clipped:t}})},t.prototype.render=function(){var e=this.props.showIntro,t=this.state,n=t.clipped,r=t.control,s=a.createElement(o.default,{clipped:n,showIntro:e,chart:"delays",xLabel:"delay",yLabel:"count",key:"delays",isCategorical:!0}),u=a.createElement(o.default,{clipped:n,xLabel:"state",yLabel:"count",chart:"state",isCategorical:!0}),h=a.createElement(o.default,{clipped:n,xLabel:"carrier",yLabel:"count",chart:"carrier",isCategorical:!0}),d=a.createElement(o.default,{clipped:n,xLabel:"day",yLabel:"count",chart:"day",isCategorical:!1,showIntro:e}),f=c.IsChronicles?a.createElement(l.default,null):null;return a.createElement("div",{className:"vis-portal"},a.createElement("div",{style:{float:"left"}},a.createElement("button",{className:"general-btn vis-btn ",style:{width:75},onClick:this.toggleClip},this.state.clipped?"":"un","zoom"),c.IsChronicles?a.createElement("button",{className:"general-btn vis-btn",onClick:i.diel.Input.deleteItx},"clear history"):null),a.createElement("br",{style:{clear:"both"}}),a.createElement("div",{id:"all-charts",className:r?"":"dimmed"},a.createElement("div",{className:"chart-layout-wrapper"},u),a.createElement("div",{className:"chart-layout-wrapper"},d),a.createElement("div",{className:"chart-layout-wrapper"},h),a.createElement("div",{className:"chart-layout-wrapper"},a.createElement("div",{style:{overflow:"auto"}},s)),a.createElement("div",{style:{clear:"both"}})),a.createElement("div",{className:r?"":"dimmed"},f,a.createElement("div",{style:{clear:"both"}})))},t.defaultProps={width:800,height:100,isTraining:!1},t}(a.Component);t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),a=n(0);t.ResetButton=function(e){return e.selection&&e.selection.length>0?r.createElement("div",{style:{height:30,width:e.width,overflow:"hidden"}},r.createElement("button",{style:{marginBottom:10},onClick:function(){return a.diel.Input.xBrushItx({$chart:e.chart})}},"reset")):r.createElement("div",{style:{height:30,width:e.width}})}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,o){function i(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(i,s)}l((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,o&&(i=2&n[0]?o.return:n[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(i=l.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){l.label=n[1];break}if(6===n[0]&&l.label<i[1]){l.label=i[1],i=n;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(n);break}i[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],o=0}finally{a=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,o,i,s,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var o=n(14),i=n(5),s=n(3),l=n(15),c=n(7),u=["day","carrier","delays","state"],h={training:{main:"/dist/main_training.db",worker:"/dist/worker_training.db"},task:{main:"/dist/main_task.db",worker:"/dist/worker_task.db"}},d={singleRow:!1,notNull:!1},f=function(){function e(){var e=this;this.LoadAll=function(t,n,o){return r(e,void 0,void 0,function(){var e=this;return a(this,function(r){switch(r.label){case 0:return console.log("diel Load",t,n),[4,this.loadMain(t)];case 1:return r.sent(),[4,this.loadWorker(n)];case 2:return r.sent(),c.setUpWorker(this.worker),this.setup(),this.boundFns.length>0&&this.boundFns.map(function(t){t.s=e.output.get(t.view)}),this.deadRequests=[],this.activeRequests=[],o&&i.loadPage(),[2]}})})},this.loadMain=function(t){return r(e,void 0,void 0,function(){var e,n;return a(this,function(r){switch(r.label){case 0:return this.db&&this.db.close(),[4,fetch(t)];case 1:return e=r.sent(),[4,e.arrayBuffer()];case 2:return n=r.sent(),this.buffer=new Uint8Array(n),this.db=new o.Database(this.buffer),[2]}})})},this.loadWorker=function(t){return r(e,void 0,void 0,function(){var e,n,r;return a(this,function(a){switch(a.label){case 0:return[4,fetch(t)];case 1:return e=a.sent(),[4,e.arrayBuffer()];case 2:return n=a.sent(),r=new Uint8Array(n),this.worker.postMessage({id:"opened",action:"open",buffer:r}),this.workerLoaded=!0,[2]}})})},console.log("Diel initializing for training"),this.LoadAll(h.training.main,h.training.worker,!0),this.worker=new Worker("./dist/worker.sql.js"),this.boundFns=[],this.workerLoaded=!1,this.activeRequests=[]}return e.prototype.BindOutput=function(e,t,n){if(void 0===n&&(n={}),!this.output.has(e))throw new Error("output not defined "+e+" "+Array.from(this.output.keys()).join(", "));var r=Object.assign({},d,n);if(e.startsWith("chron")&&!n.parameters)throw new Error("chron must have params");this.boundFns.push({view:e,s:this.output.get(e),f:t,c:r})},e.prototype.GetLogs=function(e){var t=this.logs.get(e);if(!t)throw console.log(e+" not found in diel logs",this.logs),new Error(e+" not found in diel logs");t.bind({});for(var n=[];t.step();)n.push(t.getAsObject());return n},e.prototype.GetStaticView=function(e){var t=this.staticViews.get(e);t.bind({});for(var n=[];t.step();)n.push(t.getAsObject());if(0===n.length)throw new Error("Static view "+e+" should not be empty");return n},e.prototype.SetFreeze=function(e){this.frozen=e,this.frozenBind(!e)},e.prototype.BindFreeze=function(e){this.frozenBind=e},e.prototype.ClearHistory=function(){var e=this;this.deadRequests=this.deadRequests.concat(this.activeRequests).filter(function(e){return e.ts>Date.now()-1e4}),["eqChart_SP","eventLog","navigateItx","deltaItx","deleteItx"].map(function(t){return e.db.run("delete from "+t)}),["itxId_SP","brushState_SP","brushDep_SP","dataParamHashes_SP","stateChartData","dayChartData","carrierChartData","delaysChartData","chartDataAtomic","xBrushItx"].map(function(t){e.db.run("delete from "+t+" where itxId > 4")}),this.db.run("insert into tick (timestep) values (null);")},e.prototype.processInput=function(e,t){if(!this.frozen){var n=Object.assign({$ts:s.timeNow()},t);e.run(n)}},e.prototype.setup=function(){var t=this,n=this.db;n.run("PRAGMA foreign_keys = ON;"),n.create_function("tick",this.tick()),n.create_function("workerGetChartDataView",this.workerGetChartDataView()),n.create_function("workerShareItx",this.workerShareItx()),n.create_function("timeNow",s.timeNow),n.create_function("log",s.log),n.create_function("hashCompare",s.hashCompare),this.input={xBrushItx:n.prepare("\n        insert into xBrushItx (ts, chart, low, high, low2, high2, selection)\n        values ($ts, $chart, $low, $high, $low2, $high2, $selection)"),navigateItx:n.prepare("\n        insert into navigateItx (ts, xFilterItxId)\n        values ($ts, $xFilterItxId)"),deltaItx:n.prepare("\n        insert into deltaItx (ts, val)\n        values ($ts, $val)"),deleteItx:n.prepare("\n        insert into deleteItx (ts)\n        values ($ts)")},this.Input={xBrushItx:function(e){if(e.$low&&(isNaN(e.$high)||isNaN(e.$low)))throw new Error("number has to be defined");t.processInput(t.input.xBrushItx,e)},navigateItx:function(e){t.processInput(t.input.navigateItx,e)},deltaItx:function(e){t.processInput(t.input.deltaItx,e)},deleteItx:function(){t.input.deleteItx.run({$ts:s.timeNow()})}},this.logData={thumbnail:n.prepare("\n        insert into thumbnail (ts, itxId, img)\n        values ($ts, $itxId, $img);\n      "),thumbnailRemove:n.prepare("\n        delete from thumbnail\n        where ts < $ts and itxId = $itxId;\n      "),eventLog:n.prepare("\n        insert into eventLog (ts, eventName, parameter)\n        values ($ts, $eventName, $parameter);\n      "),taskInfo:n.prepare("\n        insert into taskInfo (qId, taskType, isTraining)\n        values ($qId, $taskType, $isTraining);\n      "),taskTimes:n.prepare("\n        insert into taskTimes (ts, qId, eventType)\n        values ($ts, $qId, $eventType);\n      "),answers:n.prepare("\n        insert into answers (qId, answer, confidence, score, comment)\n        values ($qId, $answer, $confidence, $score, $comment);\n      "),memoryTask:n.prepare("\n        insert into memoryTask (qId, linkedQId)\n        values ($qId, $linkedQId);\n      ")},this.LogData={thumbnail:function(e){var n=Object.assign({$ts:s.timeNow()},e);t.logData.thumbnail.run(n),t.logData.thumbnailRemove.run({$ts:n.$ts,$itxId:e.$itxId})},eventLog:function(e){var n=Object.assign({$ts:s.timeNow()},e);t.logData.eventLog.run(n)},taskInfo:function(e){t.logData.taskInfo.run(e)},taskTimes:function(e){var n=Object.assign({$ts:s.timeNow()},e);t.logData.taskTimes.run(n)},answers:function(e){t.logData.answers.run(e)},memoryTask:function(e){t.logData.memoryTask.run(e)}},this.output=new Map,["ChartSelection","ChartIsLoading","ChartDataView"].map(function(e){u.map(function(r){var a=""+r+e;t.output.set(a,n.prepare("select * from "+a))})}),this.logs=new Map,e.ItxLogsViews.map(function(e){return t.logs.set(e,n.prepare("select * from "+e))}),e.TaskLogsViews.map(function(e){return t.logs.set(e,n.prepare("select * from "+e))}),this.output.set("thumbnail",n.prepare("select * from thumbnail order by itxId asc")),["chronDayChartSelection","chronCarrierChartSelection","chronStateChartSelection","chronDelaysChartSelection","chronDayChartDataView","chronStateChartDataView","chronCarrierChartDataView","chronDelaysChartDataView","chronLoadingStatus","chronChartTitle"].map(function(e){t.output.set(e,n.prepare("select * from "+e+" where chronRank=$chronRank"))}),["hasMoreChron"].map(function(e){return t.output.set(e,n.prepare("select * from "+e))}),this.staticViews=new Map,u.map(function(e){var r=e+"ChartInitData";t.staticViews.set(r,n.prepare("select * from "+r))})},e.prototype.tick=function(){var e=this.boundFns,t=this.runOutput;return function(){e.map(function(e){t(e)})}},e.prototype.Sanity=function(){},e.prototype.IsDuringTask=function(){var e=this.db.exec("select count(*) from taskTimes");return{firstTime:1===e[0].values[0][0],duringTask:e[0].values[0][0]%2==1}},e.prototype.exec=function(e){return this.db.exec(e)},e.prototype.workerShareItx=function(){var e=this.worker;return function(){var t=l.generateSQLForTableCopy("currentItx","SELECT * FROM currentItx");e.postMessage({id:"updateCurrentItx",action:"exec",sql:t})}},e.prototype.workerGetChartDataView=function(){var e=this,t=this.worker;return function(n,r){var a=s.timeNow()+"-"+n+"="+r;e.activeRequests.push({id:a,ts:Date.now()}),t.postMessage({id:"share:"+n+":"+r+":"+a,action:"exec",sql:"SELECT * FROM "+r+"ChartDataView;"})}},e.prototype.runOutput=function(e){var t=e.s,n=e.f,r=e.c;r.parameters?t.bind(r.parameters):t.bind({});for(var a=[];t.step();)a.push(t.getAsObject());if(r.notNull&&0===a.length)throw new Error(e.view+" should not be null");n(a.length>0&&r.singleRow?a[0]:a)},e.prototype.ChangeToTask=function(){this.LoadAll(h.task.main,h.task.worker,!1),console.log("Changed to task DB")},e.prototype.TrainingZeroCount=function(){return this.db.exec("select count(*) from answers where score = 0")[0].values[0][0]},e.prototype.downloadDB=function(){var e=this.db.export(),t=new Blob([e]);s.downloadHelper(t,"session")},e.prototype.downloadWorkerDB=function(){this.worker.postMessage({id:"download",action:"export"})},e.ItxLogsViews=["itxId_SP","brushState_SP","brushDep_SP","eqChart_SP","chartDataAtomic","eventLog","thumbnail","navigateItx","deltaItx","deleteItx","xBrushItx"],e.TaskLogsViews=["memoryTask","taskTimes","answers","taskInfo"],e}();t.default=f},function(e,t){e.exports=SQL},function(e,t,n){"use strict";function r(e,t){var n=o.diel.exec(t)[0];return i.assertQueryHasResult(n,"currentItx"),"\n    DELETE from "+e+";\n    INSERT INTO "+e+" VALUES "+n.values.map(function(e){return"("+e.map(function(e){return null===e?"null":"'"+e+"'"}).join(", ")+")"})+";"}function a(e){o.diel.worker.postMessage({id:"print",action:"exec",sql:e})}Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(3);t.generateSQLForTableCopy=r,t.dW=a,window.dW=a},function(e,t,n){"use strict";function r(e){var t=e.baseData,n=e.selection,r=e.data,s=e.chart,l=e.chartWidth,c=e.chartHeight,u=e.clipped,h=!u&&r&&r.length>0,d=h?a.max(r,function(e){return e.y}):a.max(t,function(e){return e.y}),f=a.scaleLinear().rangeRound([c,0]).domain([0,d]),p=a.extent(t,function(e){return e.x}),m=p[1]-p[0]+1,g=[p[0],p[1]+(p[1]-p[0])/m],y=.6*l/m,v=a.scaleLinear().rangeRound([1,l]).domain(g),w=function(e,t){var n=Math.round(v.invert(e)),r=Math.floor(v.invert(t));console.log("brush data",n,r),o.diel.Input.xBrushItx({$low:n,$high:r,$chart:s})},b=function(e){return function(){return o.diel.Input.xBrushItx({$low:e,$high:e,$chart:s})}},x=[],C=!(!n||!n.low);return h||t.map(function(e){var t=n&&e.x<=n.high&&e.x>=n.low?i.selectedBackgroundColor:i.lightGray;x.push({x:v(e.x),y:f(e.y),color:t,onClick:b(e.x),barWidth:y})}),r&&r.filter(function(e){return e.y>0}).map(function(e){var t=n&&e.x<=n.high&&e.x>=n.low?i.selectedColor:i.lightBlue;x.push({x:v(e.x),y:f(e.y),color:t,onClick:b(e.x),barWidth:y})}),C&&x.push({className:"selector",x:Math.max(v(n.low)-5,0),y:0,barWidth:v(n.high)-v(n.low)+y+10,color:i.brushColor,onClick:null}),{brushFn:w,rectsSpec:x,x:v,y:f,hasSelection:C}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),o=n(0),i=n(4);t.linearChartHelper=r},function(e,t,n){"use strict";function r(e){var t=e.baseData,n=e.selection,r=e.data,s=e.chart,l=e.chartWidth,c=e.chartHeight,u=e.clipped,h=!u&&r&&r.length>0,d=h?a.max(r,function(e){return e.y}):a.max(t,function(e){return e.y}),f=a.scaleLinear().rangeRound([c,0]).domain([0,d]),p=t.map(function(e){return e.x}),m=a.scaleBand().rangeRound([0,l]).padding(.4).domain(p),g=function(e,t){var n=p.filter(function(n){return m(n)&&m(n)<t&&m(n)>e}).join(",");o.diel.Input.xBrushItx({$selection:n,$chart:s})},y=function(e){return function(){return o.diel.Input.xBrushItx({$selection:e,$chart:s})}},v=m.bandwidth(),w=[],b=[];n&&n.selection&&n.selection.split(",").map(function(e){return b.push(m(e))}),t.map(function(e){w.push({x:m(e.x),y:c/2,color:"rgba(0, 0, 0, 0)",onClick:y(e.x),barWidth:v})}),h||t.map(function(e){var t=i.lightGray;if(n&&n.selection){n.selection.split(",").filter(function(t){return t===e.x}).length>0&&(t=i.selectedBackgroundColor)}w.push({x:m(e.x),y:f(e.y),color:t,onClick:y(e.x),barWidth:v})}),r&&r.filter(function(e){return e.y>0}).map(function(e){var t=i.lightBlue;if(n&&n.selection){n.selection.split(",").filter(function(t){return t===e.x}).length>0&&(t=i.selectedColor)}w.push({x:m(e.x),y:f(e.y),color:t,onClick:y(e.x),barWidth:v})}),b.length>0&&w.push({className:"selector",x:Math.max(a.min(b)-5,0),y:0,color:i.brushColor,barWidth:a.max(b)-a.min(b)+v+10,onClick:null});var x=!(!n||!n.selection);return{brushFn:g,rectsSpec:w,x:m,y:f,hasSelection:x}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),o=n(0),i=n(4);t.CategoricalChartHelper=r},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),o=n(0),i=n(19),s=function(e){function t(t){var n=e.call(this,t)||this;return n.hasMoreChron=n.hasMoreChron.bind(n),n.state={hasEarlierChron:null,hasLaterChron:null},o.diel.BindOutput("hasMoreChron",n.hasMoreChron,{singleRow:!0}),n}return r(t,e),t.prototype.hasMoreChron=function(e){this.setState({hasLaterChron:1===e.hasLater,hasEarlierChron:1===e.hasEarlier})},t.prototype.render=function(){var e=this.state,t=e.hasEarlierChron,n=e.hasLaterChron,r=[4,3,2,1,0].map(function(e){return a.createElement(i.default,{chronRank:e})}),s=a.createElement("span",{className:(t?"":"hide")+" chronArrow",onClick:function(){return o.diel.Input.deltaItx({$val:-1})}},"⇦"),l=a.createElement("span",{className:(n?"":"hide")+" chronArrow",onClick:function(){return o.diel.Input.deltaItx({$val:1})}},"⇨");return a.createElement("div",{className:"chronContainer"},s,r,l)},t}(a.Component);t.default=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),o=n(0),i=n(6),s=function(e){function t(t){var n=e.call(this,t)||this;n.state={title:null,itxId:null,isFocus:null},n.setTitle=n.setTitle.bind(n);var r={parameters:{$chronRank:t.chronRank},singleRow:!0};return o.diel.BindOutput("chronChartTitle",n.setTitle,r),n}return r(t,e),t.prototype.setTitle=function(e){this.setState({title:e.title,itxId:e.itxId,isFocus:1===e.isFocus})},t.prototype.render=function(){var e,t=this,n=this.props.chronRank,r=a.createElement(i.default,{clipped:!1,chart:"chronDelays",isChron:!0,chronRank:n,xLabel:"delay",yLabel:"count",key:"delays",isCategorical:!0}),s=a.createElement(i.default,{isChron:!0,chronRank:n,clipped:!1,xLabel:"chronState",yLabel:"count",chart:"chronState",isCategorical:!0}),l=a.createElement(i.default,{isChron:!0,chronRank:n,clipped:!1,xLabel:"carrier",yLabel:"count",chart:"chronCarrier",isCategorical:!0}),c=a.createElement(i.default,{isChron:!0,chronRank:n,clipped:!1,xLabel:"day",yLabel:"count",chart:"chronDay",isCategorical:!1});if(this.state.title){var u=this.state.title.split("&"),h=["state","day","carrier","delays"].map(function(e){var t=u.filter(function(t){return t.startsWith(e)}),n=t.length>0?t[0].substring(e.length+1):"";return a.createElement("tr",null,a.createElement("td",{className:"label-chart"},e),a.createElement("td",{className:"label-value"},n))});e=a.createElement("table",null,h)}return a.createElement("div",{className:"chron"},a.createElement("div",{className:"chronInner "+(this.state.isFocus?"chronSelected":""),onClick:function(){return o.diel.Input.navigateItx({$xFilterItxId:t.state.itxId})}},s,c,l,r),e)},t}(a.Component);t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IsChronicles=!0},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),o=n(22),i=n(0),s=[{queryShown:"create view dayChartInitDataView as\n      SELECT\n        day AS x,\n        COUNT(*) AS y\n      FROM flights\n      GROUP BY day;",ifRefresh:!1,text:"The view <i>dayChartInitDataView</i> shows using SQL to query for the static data"},{queryShown:"create view lastBrush as\n      select * from xBrushItx\n      where itxId = (\n        SELECT MAX(itxId) AS itxId\n        FROM xBrushItx\n      );",queryRan:"select * from lastBrush",ifRefresh:!0,text:"This query derives the latest brush performed; based on the last brush, we can combine with the navigation interactions to define what the combined view is next."},{queryShown:"create view focusItx as\n      select b.itxId + coalesce(delta.val, 0) as itxId\n      from lastBrush b\n      left outer join (\n      select sum(val) as val\n      from deltaItx\n    ) as delta;",queryRan:"select * from focusItxRaw",ifRefresh:!0,text:"Here to combine the navigation with that of the delta navigation interactions, we can just add from past events. There are some additional logic for checking if navigation is out of bounds, which we omit here."},{queryShown:"create view currentItx as\n      select *\n      from xBrushItx b\n      where b.itxId in (\n        select componentItx\n        from brushState_SP\n        where itxId = (select itxId from focusItx)\n      );",ifRefresh:!0,queryRan:"select * from currentItx",text:"This query illustrates how to make use of state programs to simplify finding the brushes defined in the past. <i>brushState_SP</i> is a state program table that's modified after each <i>xBrushItx</i> to reflect the active set of selected filters. Then <i>currentIt</i> is shared with the WebWorker thread that's computing the values and the response is inserted backed into main thread db as another event---into the respective tables <i>stateChartData</i>."},{queryShown:"CREATE VIEW stateChartDataView AS\n      SELECT\n        f.state AS x,\n        COUNT(*) AS y\n      FROM flights f\n      JOIN (\n        select selection\n        from currentItx\n        where chart = 'carrier'\n      ) AS fCarrier\n        on (instr(fCarrier.selection, f.carrier)\n          or fCarrier.selection IS NULL)\n      JOIN (\n        select low, high\n        from currentItx\n        where chart = 'day'\n      ) AS fDay\n        on (\n          (f.day <= fDay.high and f.day >= fDay.low)\n          or fDay.low IS NULL)\n      JOIN (\n        select selection\n        from currentItx\n        where chart = 'delays'\n      ) AS fDelays\n        on (\n          instr(fDelays.selection, f.delay)\n          or fDelays.selection IS NULL\n        )\n    GROUP BY f.state\n    order by y desc;",ifRefresh:!1,text:"This is the query ran on the worker that takes the interact records and computes the filter as one wholistic query. Note that this unified programming model---all the way from interactions to data processing eliminates the need to transform the data from events to objects and to some query language to the backend (or workers), or worse yet, custom rolled functions instead of a standard query engine."}],l=function(e){function t(t){var n=e.call(this,t)||this;return n.next=n.next.bind(n),n.prev=n.prev.bind(n),n.updateQuery=n.updateQuery.bind(n),n.state={step:0,result:null},n.updateQuery(),n}return r(t,e),t.prototype.updateQuery=function(){var e=s[this.state.step],t=null;e.queryRan&&(t=i.diel.exec(e.queryRan)[0]),this.setState({result:t})},t.prototype.next=function(){this.setState(function(e){return{step:e.step+1}})},t.prototype.prev=function(){this.setState(function(e){return{step:e.step-1}})},t.prototype.componentDidMount=function(){o.highlightAll()},t.prototype.render=function(){var e,t=this.state.result,n=s[this.state.step];if(t&&n.queryRan&&(e=a.createElement("table",{style:{fontFamily:"courier"}},a.createElement("thead",null,t.columns.map(function(e){return a.createElement("th",null,e)})),a.createElement("tbody",null,t.values.map(function(e){return a.createElement("tr",null,e.map(function(e,n){var r="ts"===t.columns[n]?new Date(e).getHours()+":"+new Date(e).getMinutes()+":"+new Date(e).getSeconds():e;return r=t.columns[n].toLowerCase().indexOf("lat")>-1||t.columns[n].toLowerCase().indexOf("long")>-1?Math.round(100*r)/100:r,a.createElement("td",null,r)}))})))),n.queryRan){var r=i.diel.exec(n.queryRan)[0];e=a.createElement("table",{style:{fontFamily:"courier"}},a.createElement("thead",null,r.columns.map(function(e){return a.createElement("th",null,e)})),a.createElement("tbody",null,r.values.map(function(e){return a.createElement("tr",null,e.map(function(e,t){var n="ts"===r.columns[t]?new Date(e).getHours()+":"+new Date(e).getMinutes()+":"+new Date(e).getSeconds():e;return n=r.columns[t].toLowerCase().indexOf("lat")>-1||r.columns[t].toLowerCase().indexOf("long")>-1?Math.round(100*n)/100:n,a.createElement("td",null,n)}))})))}return a.createElement(a.Fragment,null,a.createElement("p",{dangerouslySetInnerHTML:{__html:n.text}}),a.createElement("button",{className:"general-btn vis-btn",disabled:this.state.step<1,onClick:this.prev},"Previous"),a.createElement("button",{className:"general-btn vis-btn",disabled:this.state.step>=s.length-1,onClick:this.next},"Next"),n.ifRefresh?a.createElement("button",{className:"general-btn vis-btn",onClick:this.updateQuery},"Refresh Query"):null,a.createElement("pre",null,a.createElement("code",{className:"language-sql"},n.queryShown)),e)},t}(a.Component);t.default=l},function(e,t){e.exports=Prism}]);
//# sourceMappingURL=bundle.js.map